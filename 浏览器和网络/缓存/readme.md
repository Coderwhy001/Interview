# 浏览器的缓存
浏览器的缓存机制：
1. 强缓存
2. 协商缓存
3. 缓存位置
缓存是指代理服务器或客户端磁盘内保存的资源副本。 利用缓存可减少对服务器的访问， 因此也就节省了通信流量和通信时间
浏览器缓存是浏览器在本地磁盘对用户最近请求过的文档进行存储， 当访问者再次访问同一页面时， 浏览器就可以直接从本地磁盘加载文档
### 浏览器缓存分为强缓存和协商缓存
## 强缓存
强缓存是利用http的返回头中的Expires或者Cache-Control两个字段来控制的， 用来表示资源的缓存时间
浏览器中的缓存作用分为两种情况， 一种是需要发送HTTP请求， 一种是不需要发送
首先是检查强缓存， 这个阶段不需要发送HTTP请求
HTTP1.0时， 使用的是Expires, HTTP1.1时， 使用的是Cache-Control
## Expires
Expires即过期时间， 存在于服务端返回的响应头中， 告诉浏览器再这个过期时间内可以直接从缓存里面获取数据， 无需再次请求
他的值为一个绝对时间的GMT格式的时间字符串， 比如：
```
Expires: Mon, 22 Sept 2020 23:59:59 GMT
```
表示资源在2020年9月22日23.59.59过期失效， 过期了就要向服务器端发送请求
这种方式有个明显的缺点， 由于失效时间是一个绝对时间， 服务器的时间和浏览器的时间可能不一致， 所以服务器返回的这个过期时间可能就是不准确的， 所以HTTP1.1被废弃了
## Cache-Control
在HTTP1.1 中采取了Cache-Control
它和Expires本质的不同是它没有采取具体的过期时间点这个方式， 而是采用过期时长来控制缓存， 对应的字段是max-age， 它是一个相对时间， 比如：
```
Cache-Control:max-age=3600
```
代表资源的有效期是 3600 秒，响应返回后在 3600 秒，也就是一个小时之内可以直接使用缓存
常用的配合设置的值：

1. public：可以被所有的用户缓存，包括客户端和 CDN 等中间代理服务器(因为一个请求可能要经过不同的代理服务器才到达目标服务器)
2. private：只能被浏览器缓存，不允许 CDN 等中间代理服务器缓存
3. no-cache：不使用本地缓存，跳过当前的强缓存，直接进入 协商缓存阶段
4. no-store：直接禁止浏览器缓存，不进行任何形式的缓存，每次请求都要向服务器发送一个请求
5. s-maxage：和 max-age 比较像，但是区别在于 s-maxage 是针对代理服务器的缓存时间
当 Expires 和 Cache-Control 同时存在的时候，Cache-Control 会有效考虑
### 当缓存资源超时，强缓存失效的时候，就会进入到协商缓存阶段
## 协商缓存
协商缓存就是由服务器来确定缓存资源是否可用， 所以客户端与服务器端要通过某种标识来进行通信， 从而让服务器判断请求资源是否可以缓存访问
强缓存失效后， 浏览器在请求头中携带相应的缓存tag来向服务器请求资源， 由服务器根据这个tag， 来决定是否使用缓存
具体来说， 这样的缓存tag分为两种： Last-Modified 和 ETag，两者并不存在谁对谁有绝对的优势
## Last-Modified / If-Modified-Since
`Last-Modified`最后修改时间， 在浏览器第一次给服务器发送请求后， 服务器会在响应头中加上字段
浏览器收到后， 如果再次请求， 会在请求头中携带`If-Modified-Since`字段， 这个字段的值也就是服务器传来的最后修改时间
服务器拿到请求头中的 If-Modified-Since 的字段后，就会和服务器中 该资源的最后修改时间对比：

如果请求头中的这个时间小于最后修改时间，说明需要更新，返回新的资源
否则返回 304(不会返回资源内容)，告诉浏览器内容没有修改，可以直接使用内存
## Etag / If-None-Match
与 Last-Modified/If-Modified-Since 不同的是，Etag/If-None-Match 返回的是一个校验码
Etag 是服务器根据当前文件的内容，给文件生成的唯一标识，只要里面的内容有改动，这个值就会变化
浏览器接收到 Etag 的值，会在下次请求时，将这个值作为 If-None-Match 这个字段的内容，并放在请求头中发送给服务器
服务器拿到请求头中的 If-None-Match 后，就会和服务器中的 Etag 进行比对：

1. 如果两者不一样，说明需要更新，返回新的资源
2. 否则返回 304(不会返回资源内容)，告诉浏览器内容没有修改，可以直接使用内存

## 缓存位置
从缓存位置上来说分为四种， 并且各自有优先级， 当依次查找缓存2都没有命中的时候， 才回去请求网络
- Service Worker
- Memory Cache
- Disk Cache
- Push Cache
1. Service Worker
Service Worker 是运行在浏览器背后的独立线程， 一般可以用来实现缓存功能。 